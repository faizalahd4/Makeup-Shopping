var app=angular.module("myApp",["checklist-model"]);app.controller("productListingCtrl",function($scope,$http){$scope.allProducts=[],$scope.paramRequest={},$scope.filterType="",$scope.prices=[{text:"Under $25",value:{gt:"",lt:25}},{text:"$25 - $50",value:{gt:25,lt:50}},{text:"$50 - $100",value:{gt:50,lt:100}},{text:"$100 - $150",value:{gt:100,lt:150}},{text:"$150 - $300",value:{gt:150,lt:300}},{text:"Above $300",value:{gt:300,lt:1/0}}],$scope.typeMenus=[{text:"See all Makeup",value:"",breadCrumb:["Makeup","Sell all Makeup"]},{text:"Tools",value:"tools",breadCrumb:["Makeup","Tools"]},{text:"Brushes",value:"brushes",breadCrumb:["Makeup","Brushes"]},{text:"Eyes",value:"tools",breadCrumb:["Makeup","Eyes"]},{text:"Lips",value:"brushes",breadCrumb:["Makeup","Lips"]},{text:"Nails",value:"tools",breadCrumb:["Makeup","Nails"]}],$scope.getAllProducts=function(requestParam){$http.get("https://sephora-api-frontend-test.herokuapp.com/products"+requestParam).then(function(response){$scope.productListingOutput=response.data,response.data&&response.data.length>0&&($scope.allProducts=$scope.productListingOutput.data),"MAKEUP_FILTER"!=$scope.filterType&&"PRICE_RANGE_FILTER"!=$scope.filterType&&"PAGE_NO_FILTER"!=$scope.filterType||$scope.setPagination($scope.productListingOutput)})},$scope.initProductListing=function(){$scope.retrieveRequestParam();$scope.setPageSize($scope.pageSize)},$scope.setPageSize=function(pageSize){var request="?"+$scope.generateParam("page[size]",pageSize);$scope.filterType="PAGE_SIZE_FILTER",$scope.resetPage(),$scope.getAllProducts(request)},$scope.generateBreadCrumb=function(menus){$scope.breadcrumbMenu=menus,localStorage.setItem("breadcrumbMenu",JSON.stringify($scope.breadcrumbMenu))},$scope.setSortProduct=function(sortProduct){var request="?"+$scope.generateParam("sort",sortProduct);$scope.filterType="SORT_ORDER_FILTER",$scope.getAllProducts(request)},$scope.setPageNo=function(pageNo){var request="?"+$scope.generateParam("page[number]",pageNo);$scope.filterType="PAGE_NO_FILTER",$scope.currentPageNo=pageNo,$scope.getAllProducts(request),$scope.pageNos[$scope.pageNos.length-1]<pageNo?($scope.pageNos.push(pageNo),$scope.pageNos.shift()):$scope.pageNos[0]>pageNo&&($scope.pageNos.unshift(pageNo),$scope.pageNos.pop()),localStorage.setItem("pageNos",JSON.stringify($scope.pageNos))},$scope.setMakeupType=function(value,type,$event){$scope.filterType="MAKEUP_FILTER",$scope.currentMakeupType=type,$scope.resetPage();var request="?"+$scope.generateParam("filter[category_in]",value);$scope.getAllProducts(request),localStorage.setItem("makeupType",type)},$scope.toggleSection=function(targetId,$event){$(targetId).slideToggle("slow")},$scope.toggleClass=function(className,$event){$($event.target).toggleClass(className)},$scope.setPriceRange=function(){var request="";$scope.filterType="PRICE_RANGE_FILTER",$scope.resetPage();var ltValues=$scope.selectedPrices.map(function(obj){return obj.lt}),gtValues=$scope.selectedPrices.map(function(obj){return obj.gt});0==$scope.selectedPrices.length?($scope.generateParam("filter[price_lt]",1/0),request="?"+$scope.generateParam("filter[price_gt]",1/0)):($scope.generateParam("filter[price_lt]",Math.max.apply(null,ltValues)),request="?"+$scope.generateParam("filter[price_gt]",Math.min.apply(null,gtValues))),$scope.getAllProducts(request),localStorage.setItem("selectedPrices",JSON.stringify($scope.selectedPrices))},$scope.generateParam=function(key,value){var request="";for(var property in value==1/0||""==value?delete $scope.paramRequest[key]:$scope.paramRequest[key]=value,$scope.paramRequest)$scope.paramRequest.hasOwnProperty(property)&&(request=""==request?"":request+"&",request+=property+"="+$scope.paramRequest[property]);return localStorage.setItem("requestParam",JSON.stringify($scope.paramRequest)),request},$scope.retrieveRequestParam=function(){$scope.paramRequest=localStorage.getItem("requestParam")?JSON.parse(localStorage.getItem("requestParam")):{},$scope.pageSize=$scope.paramRequest["page[size]"]?$scope.paramRequest["page[size]"]:6,$scope.sortProduct=$scope.paramRequest.sort?$scope.paramRequest.sort:"Best Selling",$scope.currentPageNo=$scope.paramRequest["page[number]"]?$scope.paramRequest["page[number]"]:1,$scope.currentMakeupType=localStorage.getItem("makeupType")?localStorage.getItem("makeupType"):"Sell all Makeup",$scope.breadcrumbMenu=localStorage.getItem("breadcrumbMenu")?JSON.parse(localStorage.getItem("breadcrumbMenu")):["Makeup","Sell all Makeup"],$scope.pageNos=localStorage.getItem("pageNos")?JSON.parse(localStorage.getItem("pageNos")):[1,2,3],$scope.selectedPrices=localStorage.getItem("selectedPrices")?JSON.parse(localStorage.getItem("selectedPrices")):[]},$scope.resetPage=function(){$scope.paramRequest["page[number]"]=1,$scope.currentPageNo=1},$scope.setPagination=function(response){if($scope.pageNos=[1],response.links&&response.links.last){var pages=new URL(response.links.last).searchParams.get("page[number]");$scope.pageNos=pages>2?[1,2,3]:2==pages?[1,2]:[1]}localStorage.setItem("pageNos",JSON.stringify($scope.pageNos))},$scope.initProductListing()}),app.config(function($provide,$httpProvider){$provide.factory("MyHttpInterceptor",function($q){return{request:function(config){return $("#loader").fadeIn(),config||$q.when(config)},requestError:function(rejection){return $("#loader").fadeOut(),$q.reject(rejection)},response:function(response){return $("#loader").fadeOut(),response||$q.when(response)},responseError:function(rejection){return $("#loader").fadeOut(),$q.reject(rejection)}}}),$httpProvider.interceptors.push("MyHttpInterceptor")});